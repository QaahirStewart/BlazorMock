@page "/admin-dashboard-examples/step10"
@rendermode InteractiveServer
@using BlazorMock.Components.Pages.Examples.AdminDashboard.Step10
@inherits ExampleBase

<PageTitle>Admin Dashboard Step 10: Route Protection & Roles - Example</PageTitle>

<div class="min-h-screen py-8 rounded-4xl bg-gray-50">
    <div class="w-full mx-auto px-4 max-w-5xl">
        <a href="/admin-dashboard-guide"
            class="inline-flex items-center gap-2 text-sm sm:text-base text-blue-600 hover:text-blue-700 mb-4">
            <span>‚Üê</span> Back to Admin Dashboard Guide
        </a>

        <h1 class="text-4xl font-bold text-gray-900 mb-4">
            üîê Step 10: Protecting Your Pages (Who Can See What)
        </h1>

        <p class="text-xl text-gray-600 mb-8">
            Not everyone should see everything in your app! In this step, you'll add "guards" (think of them as friendly
            bouncers) that check if someone is signed in and has the right permissions before showing them certain pages.
            Regular users get basic features, paid users get more, and admins see everything.
        </p>

        <div class="bg-gradient-to-r from-gray-100 to-blue-100 rounded-2xl p-5 sm:p-6 mb-6">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4">What You'll Protect</h2>
            <ul class="list-disc ml-6 text-sm sm:text-base text-gray-700 space-y-2 mb-4">
                <li>Send people to the sign-in page if they try to visit Profile or Analytics without being logged in</li>
                <li>Show different content based on who's signed in: free users see "upgrade" messages, paid users see full
                    features, admins see everything</li>
                <li>Use your auth service to check permissions (no need to write complicated if-statements everywhere!)</li>
                <li>Keep the admin dashboard locked to admins only‚Äîregular users get a friendly "you need admin access"
                    message</li>
            </ul>
            <div class="mt-2 pt-3 border-t border-blue-200">
                <p class="text-xs sm:text-sm text-gray-700 mb-2">
                    <strong>üí° What You'll Practice:</strong> Protecting pages, checking user permissions, and showing different
                    content to different types of users.
                </p>
                <div class="flex flex-wrap items-center gap-2">
                    <span class="text-xs sm:text-sm text-gray-600">‚Üí Related tips:</span>
                    <a href="/tips#auth-service"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">Auth
                        Service</a>
                    <a href="/tips#layout-state"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">Layout
                        State</a>
                    <a href="/tips#tailwind"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">Tailwind
                        Layouts</a>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">üß© How to Protect Your Pages</h2>
            <p class="text-sm text-gray-600 mb-4">
                Here's how to add protection to your pages. These code examples show you the pattern‚Äîcheck if someone is
                signed in, and if not, send them to the sign-in page. Then check their role to decide what they can see.
            </p>

            <div class="space-y-5">
                <div class="bg-gray-100 border border-gray-200 rounded-lg p-4 overflow-x-auto">
                    <div class="text-xs text-gray-500 mb-1">Components/Pages/Demo/DashboardDemo/Profile.razor</div>
                    <p class="text-xs text-gray-600 mb-2">This checks if someone is signed in. If not, it sends them to
                        the sign-in page before showing any profile info.</p>
                    <pre data-code-title="Profile.razor ‚Äî redirect guard"
                        class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">@@page "/profile"
@@rendermode InteractiveServer
@@inherits ProfileBase

&lt;PageTitle&gt;My Profile&lt;/PageTitle&gt;

@@if (Auth.CurrentUser == null)
{
    Nav.NavigateTo("/signin");
}
else
{
    &lt;div class="py-10 px-4 bg-gray-50 rounded-3xl"&gt;
        &lt;!-- Full profile layout with avatar editing, stats, etc. --&gt;
    &lt;/div&gt;
}</pre>
                </div>

                <div class="bg-gray-100 border border-gray-200 rounded-lg p-4 overflow-x-auto">
                    <div class="text-xs text-gray-500 mb-1">Components/Pages/Demo/DashboardDemo/Analytics.razor</div>
                    <p class="text-xs text-gray-600 mb-2">First checks if signed in (same as Profile), then shows different
                        content based on whether they're a free user, paid user, or admin.</p>
                    <pre data-code-title="Analytics.razor ‚Äî auth + role branches"
                        class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">@@page "/analytics"
@@rendermode InteractiveServer
@@inherits AnalyticsBase

&lt;PageTitle&gt;Analytics&lt;/PageTitle&gt;

@@if (Auth.CurrentUser == null)
{
    Nav.NavigateTo("/signin");
}
else
{
    &lt;div class="py-8 bg-gray-50"&gt;
        &lt;!-- Basic metrics visible to every signed-in account --&gt;

        @@if (IsPaidOrAdmin)
        {
            &lt;!-- Advanced cards, traffic sources, etc. --&gt;
        }
        else
        {
            &lt;!-- Upgrade CTA block shown to Free accounts --&gt;
        }

        @@if (IsAdmin)
        {
            &lt;!-- Admin-only aggregate stats pulled from Auth.AllUsers --&gt;
        }
    &lt;/div&gt;
}</pre>
                </div>

                <div class="bg-gray-100 border border-gray-200 rounded-lg p-4 overflow-x-auto">
                    <div class="text-xs text-gray-500 mb-1">Components/Pages/Demo/DashboardDemo/Analytics.razor.cs</div>
                    <p class="text-xs text-gray-600 mb-2">Helpers that keep role math out of the Razor file.</p>
                    <pre data-code-title="AnalyticsBase.cs ‚Äî role helpers"
                        class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">public partial class AnalyticsBase : ComponentBase
{
    [Inject] protected IUserAuthService Auth { get; set; } = default!;
    [Inject] protected NavigationManager Nav { get; set; } = default!;

    protected bool IsPaidOrAdmin =&gt; Auth.CurrentUser?.Role == "Paid" || Auth.CurrentUser?.Role == "Admin";
    protected bool IsAdmin =&gt; Auth.CurrentUser?.Role == "Admin";
}</pre>
                </div>

                <div class="bg-gray-100 border border-gray-200 rounded-lg p-4 overflow-x-auto">
                    <div class="text-xs text-gray-500 mb-1">Components/Pages/Demo/DashboardDemo/AdminDashboard.razor
                    </div>
                    <p class="text-xs text-gray-600 mb-2">Same guard as Step 9: non-admins see the friendly lockout
                        card.</p>
                    <pre data-code-title="AdminDashboard.razor ‚Äî friendly lockout"
                        class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">@@if (Auth.CurrentUser is null || Auth.CurrentUser.Role != "Admin")
{
    &lt;div class="bg-gray-50 py-12 rounded-3xl"&gt;
        &lt;div class="max-w-md mx-auto px-4"&gt;
            &lt;div class="bg-white rounded-2xl border-2 border-gray-200 p-8 text-center"&gt;
                &lt;h2 class="text-2xl font-bold"&gt;Admin Access Required&lt;/h2&gt;
                &lt;p class="text-gray-600 mb-6"&gt;You need admin privileges to access this page.&lt;/p&gt;
                &lt;a href="/signin" class="block w-full px-6 py-3 bg-blue-600 text-white rounded-lg"&gt;Sign In&lt;/a&gt;
                &lt;a href="/" class="block w-full px-6 py-3 bg-white border-2 border-gray-200 rounded-lg"&gt;Go Home&lt;/a&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
}
else
{
    &lt;!-- Admin-only dashboard shell (Step 9) --&gt;
}</pre>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4">üìù Important Notes & Tips</h2>
            <div class="space-y-3">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="text-sm font-bold text-blue-900 mb-3">üí° Pro Tips</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm font-semibold text-blue-900 mb-2">Check early, check often</p>
                            <p class="text-xs text-blue-800">Put your "are they signed in?" check at the very top of your
                                page. That way, protected content never flashes on screen for people who shouldn't see it.</p>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-blue-900 mb-2">Let the service do the work</p>
                            <p class="text-xs text-blue-800">Your auth service already knows if someone is paid or an admin.
                                Just use `IsPaidOrAdmin` and `IsAdmin` instead of writing the same checks over and over.</p>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-blue-900 mb-2">Be friendly when saying no</p>
                            <p class="text-xs text-blue-800">When someone can't access something, show a nice message with a
                                button (like "Upgrade to Pro" or "Sign In") so they know what to do next.</p>
                        </div>
                    </div>
                </div>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h3 class="text-sm font-bold text-yellow-900 mb-2">‚ö†Ô∏è Common Issues</h3>
                    <ul class="list-disc ml-6 text-sm text-yellow-900 space-y-1">
                        <li>Everyone getting bounced to sign-in? Make sure you've injected your auth service at the top of
                            the page.</li>
                        <li>Admins not seeing admin features? Check that your user's role is exactly "Admin" (with a capital
                            A)‚Äîspelling and capitalization matter!</li>
                        <li>Free users not seeing upgrade messages? Double-check that your `IsPaidOrAdmin` helper checks for
                            both "Paid" and "Admin" users.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-gray-100 to-blue-100 rounded-xl p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üõ†Ô∏è Step-by-Step Guide</h2>
            <ol class="list-decimal ml-5 space-y-2 text-gray-700 text-sm sm:text-base">
                <li><strong>Add the sign-in check:</strong> At the top of your Profile and Analytics pages, check if
                    `Auth.CurrentUser` is null. If it is, redirect them to `/signin`.</li>
                <li><strong>Show different content by role:</strong> Use `IsPaidOrAdmin` to show full features to paid
                    users and admins, and show "upgrade" messages to free users.</li>
                <li><strong>Protect the admin dashboard:</strong> Use `IsAdmin` to check if someone is an admin. If not,
                    show them a friendly "admin access required" message.</li>
                <li><strong>Keep buttons helpful:</strong> When someone can't access something, give them a clear button
                    like "Upgrade" or "Sign In" so they know what to do.</li>
                <li><strong>Test with different users:</strong> Try signing in as a free user, paid user, and admin to
                    make sure everyone sees the right stuff!</li>
            </ol>
        </div>

        <div class="bg-black/3 rounded-2xl p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üé¨ Try It Out with Different Users</h2>
            <p class="text-sm text-gray-600 mb-4">
                Click these buttons to see how your app treats different types of users. Each button signs you in as a
                different user type and takes you to a protected page.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <a href="/signin?demo=free&redirect=%2Fprofile" target="_blank" rel="noopener"
                    class="bg-white rounded-2xl border border-gray-200 p-4 flex flex-col gap-3 hover:border-blue-400 hover:shadow-lg transition-all duration-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-900">Free ‚Üí /profile</h3>
                        <span class="px-2 py-1 text-[11px] rounded-full bg-gray-100 text-gray-700">Redirect</span>
                    </div>
                    <p class="text-xs text-gray-600">Signs you in as a free user and takes you to the Profile page. Free
                        users can see their profile but will see "upgrade" prompts on Analytics.</p>
                </a>
                <a href="/signin?demo=paid&redirect=%2Fanalytics" target="_blank" rel="noopener"
                    class="bg-white rounded-2xl border border-gray-200 p-4 flex flex-col gap-3 hover:border-purple-400 hover:shadow-lg transition-all duration-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-900">Paid ‚Üí /analytics</h3>
                        <span class="px-2 py-1 text-[11px] rounded-full bg-purple-100 text-purple-800">Paid view</span>
                    </div>
                    <p class="text-xs text-gray-600">Signs you in as a paid user. You'll see full analytics features
                        (no upgrade prompts), but not the admin-only statistics at the bottom.</p>
                </a>
                <a href="/signin?demo=admin&redirect=%2Fanalytics" target="_blank" rel="noopener"
                    class="bg-white rounded-2xl border border-gray-200 p-4 flex flex-col gap-3 hover:border-red-400 hover:shadow-lg transition-all duration-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-900">Admin ‚Üí everything</h3>
                        <span class="px-2 py-1 text-[11px] rounded-full bg-red-100 text-red-800">Admin</span>
                    </div>
                    <p class="text-xs text-gray-600">Signs you in as an admin. You'll see everything‚Äîall analytics
                        features plus the admin statistics panel at the bottom. Admins have access to everything!</p>
                </a>
            </div>
            <p class="text-xs text-gray-600 mt-4 text-center">After trying these demo accounts, sign in with each type of
                user in your own app and visit different pages to make sure the protection works correctly!
            </p>
        </div>

        <div class="bg-white rounded-xl p-6 border-2 border-green-200 mb-6">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-1">Finished Step 10?</h3>
                    <p class="text-sm text-gray-600">Mark this step as complete to track your Admin Dashboard learning
                        progress.</p>
                </div>
                @if (isComplete)
                {
                    <div class="flex items-center gap-3">
                        <span class="px-4 py-2 rounded-full bg-green-100 text-green-700 font-medium">‚úì Completed</span>
                        <button @onclick="ResetStep"
                            class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                            Reset
                        </button>
                    </div>
                }
                else
                {
                    <button @onclick="MarkComplete"
                        class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">
                        Mark as Complete
                    </button>
                }
            </div>
        </div>

        <div class="mt-8">
            <div class="bg-black/90 rounded-2xl p-6 sm:p-8 text-white text-center">
                <p class="text-lg sm:text-xl font-semibold mb-4">Continue Learning</p>
                <p class="text-sm text-gray-300 mb-6 max-w-2xl mx-auto">
                    Great job protecting your pages! Next up: building a navigation bar that works on both desktop and
                    mobile.
                </p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                    <a href="/admin-dashboard-guide"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl transition-colors">
                        <span class="text-lg">‚Üê</span>
                        <span class="text-sm sm:text-base font-semibold">Back to Guide</span>
                    </a>
                    <a href="/admin-dashboard-examples/step9"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl transition-colors">
                        <span class="text-lg">‚Üê</span>
                        <span class="text-sm sm:text-base font-semibold">Previous: Step 9</span>
                    </a>
                    <a href="/admin-dashboard-examples/step11"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl transition-colors">
                        <span class="text-sm sm:text-base font-semibold">Next: Step 11</span>
                        <span class="text-lg">‚Üí</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>