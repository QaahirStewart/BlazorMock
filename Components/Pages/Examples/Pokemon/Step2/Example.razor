@page "/pokemon-examples/step2"
@rendermode InteractiveServer
@inherits ExampleBase

<PageTitle>Pokemon Step 2: Call PokeAPI and Render List - Example</PageTitle>

<div class="min-h-screen py-8 rounded-4xl bg-gray-50">
    <div class="w-full mx-auto px-4 max-w-5xl">
        <!-- Header -->
        <div class="mb-8">
            <a href="/pokemon-guide"
                class="inline-flex items-center gap-2 text-sm sm:text-base text-blue-600 hover:text-blue-700 mb-4">
                <span>‚Üê</span> Back to Pokemon Guide
            </a>
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                üéØ Step 2: Call PokeAPI and Render List
            </h1>
            <p class="text-xl text-gray-600">
                Fetch Pokemon data from the PokeAPI, deserialize the JSON into C# models, and render a simple list.
            </p>
        </div>

        <!-- What You'll Learn -->
        <div class="bg-gradient-to-r from-gray-100 to-blue-100 rounded-2xl p-5 sm:p-6 mb-6">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4">What You'll Learn</h2>
            <p class="text-gray-700 mb-4 text-sm sm:text-base">You'll call the public PokeAPI from a Blazor
                component, map the JSON into simple C# models, and render a clean list with Razor.</p>

            <ul class="list-disc ml-6 text-sm sm:text-base text-gray-700 space-y-2 mb-4">
                <li>Use an <code>IHttpClientFactory</code> named client like <code>"PokeApi"</code> for HTTP
                    calls.</li>
                <li>Call <code>GetFromJsonAsync&lt;T&gt;</code> to fetch and deserialize JSON in one step.</li>
                <li>Create tiny C# models (DTOs) that match the JSON you care about.</li>
                <li>Loop with <code>@@foreach</code> in Razor to render one card per Pokemon.</li>
            </ul>

            <div class="mt-2 pt-3 border-t border-blue-200">
                <p class="text-xs sm:text-sm text-gray-700 mb-2"><strong>üí° Key Concepts:</strong> HTTP clients, JSON
                    deserialization, DTO models, Razor <code>@@foreach</code> loops</p>
                <div class="flex flex-wrap items-center gap-2">
                    <span class="text-xs sm:text-sm text-gray-600">‚Üí Related tips:</span>
                    <a href="/tips#ihttpclientfactory"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">IHttpClientFactory</a>
                    <a href="/tips#getfromjsonasynct"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">GetFromJsonAsync&lt;T&gt;</a>
                    <a href="/tips#dto-models"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">DTO
                        models</a>
                    <a href="/tips#foreach-in-razor"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">@@foreach
                        in Razor</a>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">üß© Sample Component: Simple Pokemon List</h2>

            <p class="text-sm text-gray-600 mb-4">
                This example shows a complete Razor component you can drop into your project
                to verify that the PokeAPI call works end-to-end.
            </p>

            <div class="bg-gray-100 border border-gray-200 rounded-lg p-4 overflow-x-auto mb-4">
                <div class="text-xs text-gray-500 mb-1">PokemonListExample.razor</div>
                <p class="text-xs text-gray-600 mb-2">Full component that wires up the @@page route, injects the HTTP
                    client, fetches Pokemon, and renders the list UI.</p>
                <ul class="list-disc ml-4 mb-3 text-[11px] text-gray-600 space-y-1">
                    <li>Defines the route, injected services, models, and Razor markup in one file.</li>
                    <li>Calls PokeAPI once in <code>OnInitializedAsync</code> and stores results in a list.</li>
                    <li>Renders a responsive grid of cards, one per Pokemon, using <code>@@foreach</code>.</li>
                </ul>
                <pre data-code-title="Razor + C# (PokemonListExample.razor)"
                    class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">@@page "/pokemon-examples/demo-list"
@@inject IHttpClientFactory HttpClientFactory

&lt;h3 class="text-xl font-semibold mb-3"&gt;First 20 Pokemon&lt;/h3&gt;

@@if (pokemon is null)
{
    &lt;p class="text-gray-500"&gt;Loading...&lt;/p&gt;
}
else
{
    &lt;ul class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"&gt;
        @@foreach (var p in pokemon)
        {
            &lt;li class="bg-white border border-gray-200 rounded-xl px-3 py-2"&gt;
                &lt;p class="text-xs text-gray-500"&gt;Pokemon&lt;/p&gt;
                &lt;p class="font-semibold capitalize"&gt;@@p.Name&lt;/p&gt;
            &lt;/li&gt;
        }
    &lt;/ul&gt;
}

@@code {
    private List&lt;PokemonItem&gt;? pokemon;

    protected override async Task OnInitializedAsync()
    {
        var client = HttpClientFactory.CreateClient("PokeApi");
        var response = await client.GetFromJsonAsync&lt;PokemonListResponse&gt;("pokemon?limit=20");

        pokemon = response?.Results ?? new List&lt;PokemonItem&gt;();
    }
}

public class PokemonListResponse
{
    public List&lt;PokemonItem&gt; Results { get; set; } = new();
}

public class PokemonItem
{
    public string Name { get; set; } = "";
    public string Url { get; set; } = "";
}</pre>
            </div>

            <h3 class="text-sm font-semibold text-gray-800 mb-2">Step-by-step breakdown</h3>
            <div class="grid gap-4">
                <div class="bg-gray-100 border border-gray-200 rounded-lg p-4">
                    <div class="text-xs text-gray-500 mb-1">1. Add the route + inject your client</div>
                    <p class="text-xs text-gray-600 mb-2">This top section configures the page URL and gives you a typed
                        HTTP client named <code>PokeApi</code> for calling the external API.</p>
                    <ul class="list-disc ml-4 mb-2 text-[11px] text-gray-600 space-y-1">
                        <li><code>@@page</code> defines the route where this demo lives.</li>
                        <li><code>@@inject IHttpClientFactory</code> lets you create an <code>HttpClient</code>
                            configured in <code>Program.cs</code>.</li>
                    </ul>
                    <pre
                        class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">@@page "/pokemon-examples/demo-list"
@@inject IHttpClientFactory HttpClientFactory</pre>
                </div>

                <div class="bg-gray-100 border border-gray-200 rounded-lg p-4">
                    <div class="text-xs text-gray-500 mb-1">2. Create your models</div>
                    <p class="text-xs text-gray-600 mb-2">These tiny DTO classes match just the part of the PokeAPI JSON
                        you care about: the <code>results</code> list with each Pokemon's name and URL.</p>
                    <ul class="list-disc ml-4 mb-2 text-[11px] text-gray-600 space-y-1">
                        <li><code>PokemonListResponse</code> wraps the array of Pokemon items.</li>
                        <li><code>PokemonItem</code> holds the <code>Name</code> and <code>Url</code> fields from the
                            API.</li>
                    </ul>
                    <pre
                        class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">public class PokemonListResponse
{
    public List&lt;PokemonItem&gt; Results { get; set; } = new();
}

public class PokemonItem
{
    public string Name { get; set; } = "";
    public string Url { get; set; } = "";
}</pre>
                </div>

                <div class="bg-gray-100 border border-gray-200 rounded-lg p-4">
                    <div class="text-xs text-gray-500 mb-1">3. Fetch data in <code>OnInitializedAsync</code></div>
                    <p class="text-xs text-gray-600 mb-2">This block runs once when the component loads, calls the
                        PokeAPI, and stores the deserialized results in a list you can render.</p>
                    <ul class="list-disc ml-4 mb-2 text-[11px] text-gray-600 space-y-1">
                        <li>Creates a named client from <code>IHttpClientFactory</code>.</li>
                        <li>Uses <code>GetFromJsonAsync&lt;PokemonListResponse&gt;</code> to fetch and deserialize in
                            one step.</li>
                        <li>Copies the <code>Results</code> into the <code>pokemon</code> field so Razor can loop over
                            it.</li>
                    </ul>
                    <pre
                        class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">@@code {
    private List&lt;PokemonItem&gt; pokemon = new();

    protected override async Task OnInitializedAsync()
    {
        var client = HttpClientFactory.CreateClient("PokeApi");
        var response = await client.GetFromJsonAsync&lt;PokemonListResponse&gt;("pokemon?limit=20");
        
        if (response?.Results != null)
        {
            pokemon = response.Results;
        }
    }
}</pre>
                </div>

                <div class="bg-gray-100 border border-gray-200 rounded-lg p-4">
                    <div class="text-xs text-gray-500 mb-1">4. Render the list markup</div>
                    <p class="text-xs text-gray-600 mb-2">Finally, this markup loops over the loaded Pokemon list and
                        renders one simple card per item in a responsive grid.</p>
                    <ul class="list-disc ml-4 mb-2 text-[11px] text-gray-600 space-y-1">
                        <li>Uses <code>@@foreach</code> to generate one <code>&lt;li&gt;</code> per Pokemon.</li>
                        <li>Shows a small label plus the Pokemon's capitalized name inside a styled card.</li>
                        <li>Uses CSS grid classes to lay out multiple cards nicely.</li>
                    </ul>
                    <pre
                        class="code-block text-xs sm:text-sm font-mono text-gray-800 w-full max-w-full overflow-x-auto">&lt;ul class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"&gt;
    @@foreach (var p in pokemon)
    {
        &lt;li class="bg-white border border-gray-200 rounded-xl px-3 py-2"&gt;
            &lt;p class="text-xs text-gray-500"&gt;Pokemon&lt;/p&gt;
            &lt;p class="font-semibold capitalize"&gt;@@p.Name&lt;/p&gt;
        &lt;/li&gt;
    }
&lt;/ul&gt;</pre>
                </div>
            </div>
        </div>

        <!-- Important Notes & Tips -->
        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4">üìù Important Notes & Tips</h2>

            <div class="space-y-3">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="text-sm font-bold text-blue-900 mb-3">üí° Pro Tips</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm font-semibold text-blue-900 mb-2">Extract Pokemon ID from URL for sprite images</p>
                            <p class="text-xs text-blue-800 mb-2">The list endpoint only returns name and URL, not images. Parse the Pokemon ID from the <code class="bg-white px-1 rounded">url</code> field and build sprite URLs manually to show Pokemon images without making extra API calls.</p>
                            <code class="text-xs bg-white px-2 py-1 rounded block">https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/{id}.png</code>
                        </div>
                        
                        <div>
                            <p class="text-sm font-semibold text-blue-900 mb-2">Use <code class="bg-white px-1 rounded">GetFromJsonAsync&lt;T&gt;</code> for cleaner code</p>
                            <p class="text-xs text-blue-800">This method fetches JSON and deserializes it into your C# model in a single step, avoiding separate <code class="bg-white px-1 rounded">GetAsync</code> and <code class="bg-white px-1 rounded">ReadAsStringAsync</code> calls with built-in error handling.</p>
                        </div>
                        
                        <div>
                            <p class="text-sm font-semibold text-blue-900 mb-2">Start with small limits during development</p>
                            <p class="text-xs text-blue-800">Use <code class="bg-white px-1 rounded">?limit=20</code> in your API calls while building and testing for faster load times and quicker iteration. Increase the limit to 50-100+ once your component is stable.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h3 class="text-sm font-bold text-yellow-900 mb-2">‚ö†Ô∏è Troubleshooting</h3>
                    <ul class="list-disc ml-6 text-sm text-yellow-900 space-y-1">
                        <li>If you get a <code class="bg-white px-1 rounded">null</code> response or see no Pokemon,
                            verify
                            that the <code class="bg-white px-1 rounded">PokeApi</code> HttpClient is registered in
                            <code class="bg-white px-1 rounded">Program.cs</code> as shown in Step 0
                        </li>
                        <li>Check the browser console for any network errors or failed API calls</li>
                        <li>Ensure your models' property names match the JSON structure (case-sensitive)</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-gray-100 to-blue-100 rounded-2xl p-5 sm:p-6 mb-6">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-4">üõ†Ô∏è How to do it</h2>
            <ol class="list-decimal ml-5 space-y-2 text-gray-700 text-sm sm:text-base">
                <li>
                    <strong>Create the component file:</strong>
                    Create a new file called <code>PokemonListExample.razor</code> in the
                    <code>Components/Pages/Examples/Pokemon/Step2</code> folder.
                </li>
                <li>
                    <strong>Add the sample code:</strong>
                    Copy the full code from the "Razor + C# (PokemonListExample.razor)" block above into that file.
                </li>
                <li>
                    <strong>Run the app:</strong>
                    Build and run, then navigate to <code>/pokemon-examples/demo-list</code> to see the list of
                    Pokemon.
                </li>
            </ol>
        </div>

        <!-- Live Demo -->
        <div class="bg-black/3 rounded-2xl p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üé¨ Live Demo</h2>
            <p class="text-sm text-gray-600 mb-4">This demo calls the real PokeAPI and shows the first few Pokemon using
                the same pattern as the sample component.</p>

            <div class="bg-white rounded-2xl border border-gray-200 p-6">
                @if (livePokemon is null)
                {
                    <p class="text-sm text-gray-500">Loading Pokemon from PokeAPI...</p>
                }
                else if (livePokemon.Count == 0)
                {
                    <p class="text-sm text-gray-500">No Pokemon found. Try refreshing the page.</p>
                }
                else
                {
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                        @foreach (var p in livePokemon)
                        {
                            <div class="rounded-2xl border border-gray-200 bg-white p-4 flex flex-col items-center gap-2">
                                <div
                                    class="h-16 w-16 rounded-full bg-blue-50 flex items-center justify-center overflow-hidden mb-1">
                                    @if (!string.IsNullOrWhiteSpace(p.SpriteUrl))
                                    {
                                        <img src="@p.SpriteUrl" alt="@p.Name" class="h-14 w-14 object-contain" />
                                    }
                                    else
                                    {
                                        <span class="text-lg">‚ùì</span>
                                    }
                                </div>
                                <p class="text-xs text-gray-500 uppercase tracking-wide">Pokemon</p>
                                <p class="text-sm font-semibold capitalize text-gray-900">@p.Name</p>
                            </div>
                        }
                    </div>
                }
            </div>

            <p class="text-xs text-gray-600 mt-4 text-center">üí° This is the same pattern you can reuse in your own
                components: fetch in OnInitializedAsync, store data in a list, and render it with a simple Razor loop.
            </p>
        </div>

        <div class="bg-white rounded-xl p-6 border-2 border-green-200 mb-6">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-1">Finished Step 2?</h3>
                    <p class="text-sm text-gray-600">Mark complete when you can see a list of Pokemon</p>
                </div>
                @if (isComplete)
                {
                    <div class="flex items-center gap-3">
                        <span class="px-4 py-2 rounded-full bg-green-100 text-green-700 font-medium">‚úì Completed</span>
                        <button @onclick="ResetStep"
                            class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">Reset</button>
                    </div>
                }
                else
                {
                    <button @onclick="MarkComplete"
                        class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">Mark
                        as Complete</button>
                }
            </div>
        </div>

        <!-- Navigation -->
        <div class="mt-8">
            <div class="bg-black/90 rounded-2xl p-6 sm:p-8 text-white text-center">
                <p class="text-lg sm:text-xl font-semibold mb-4">Continue Learning</p>
                <p class="text-sm text-gray-300 mb-6 max-w-2xl mx-auto">
                    Your Pokemon list looks great! Now let's add pagination.
                </p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                    <a href="/pokemon-guide"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl transition-colors">
                        <span class="text-lg">‚Üê</span>
                        <span class="text-sm sm:text-base font-semibold">Back to Guide</span>
                    </a>
                    <a href="/pokemon-examples/step1"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl transition-colors">
                        <span class="text-lg">‚Üê</span>
                        <span class="text-sm sm:text-base font-semibold">Previous: Step 1</span>
                    </a>
                    <a href="/pokemon-examples/step3"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl transition-colors">
                        <span class="text-sm sm:text-base font-semibold">Next: Step 3</span>
                        <span class="text-lg">‚Üí</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>