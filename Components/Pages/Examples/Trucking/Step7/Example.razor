@page "/trucking-examples/step7"
@inherits ExampleBase
@rendermode InteractiveServer

<PageTitle>Trucking Step 7: EF Core Models - Example</PageTitle>

<div class="min-h-screen py-8 rounded-4xl bg-gray-50">
    <div class="w-full mx-auto px-4 max-w-5xl">
        <!-- Header -->
        <div class="mb-8">
            <a href="/trucking-guide"
                class="inline-flex items-center gap-2 text-sm sm:text-base text-blue-600 hover:text-blue-700 mb-4">
                <span>‚Üê</span> Back to Trucking Guide
            </a>
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                üéØ Step 7: EF Core Models
            </h1>
            <p class="text-xl text-gray-600">
                Learn to create domain models with data annotations for Entity Framework Core validation and database
                configuration.
            </p>
        </div>

        <!-- What You'll Learn -->
        <div class="bg-gradient-to-r from-gray-100 to-blue-100 rounded-xl p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üìò What You'll Learn</h2>
            <p class="text-gray-700 mb-3">
                Entity Framework Core models are POCOs (Plain Old CLR Objects) that represent database tables with
                properties, validation, and relationships.
            </p>
            <ul class="list-disc pl-5 text-gray-700 space-y-2">
                <li>Create POCO classes for database entities</li>
                <li>Apply data annotations ([Required], [StringLength], [Range]) for validation</li>
                <li>Use enums with [Display] attributes for type-safe categorical data</li>
                <li>Define navigation properties to establish entity relationships</li>
                <li>Add business logic methods to model classes</li>
            </ul>

            <!-- Key Concepts Footer -->
            <div class="mt-4 pt-3 border-t border-blue-200">
                <p class="text-xs sm:text-sm text-gray-700 mb-2">
                    <strong>üí° Key Concepts:</strong> POCO Models, Data Annotations, Navigation Properties
                </p>
                <div class="flex flex-wrap items-center gap-2">
                    <span class="text-xs sm:text-sm text-gray-600">‚Üí Related tips:</span>
                    <a href="/tips#poco-models"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">POCO
                        Models</a>
                    <a href="/tips#data-annotations"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">Data
                        Annotations</a>
                    <a href="/tips#navigation-properties"
                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[11px] sm:text-xs font-medium hover:bg-blue-200 transition-colors">Navigation
                        Properties</a>
                </div>
            </div>
        </div>

        <!-- Code Example: Basic Model -->
        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <div class="mb-3">
                <p class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Code Example 1</p>
                <h3 class="text-lg font-semibold text-gray-800 mt-1">Basic EF Core Model</h3>
            </div>
            <p class="text-xs text-gray-600 mb-3">
                A simple model class with properties, data annotations for validation, and database configuration.
            </p>
            <ul class="list-disc pl-5 text-[11px] text-gray-600 space-y-1 mb-4">
                <li><code class="px-1 rounded bg-gray-100">Id</code> property is auto-detected as primary key by EF Core
                </li>
                <li><code class="px-1 rounded bg-gray-100">[Required]</code> ensures field cannot be null in database
                </li>
                <li><code class="px-1 rounded bg-gray-100">[StringLength]</code> sets maximum length and validation</li>
                <li><code class="px-1 rounded bg-gray-100">[Range]</code> validates numeric values within bounds</li>
            </ul>
            <div class="bg-gray-100 rounded-lg p-4 overflow-x-auto">
                <pre data-code-title="C# (Models/Driver.cs)">
using System.ComponentModel.DataAnnotations;

namespace BlazorMock.Models;

public class Driver
{
    // Primary Key (auto-detected by EF Core)
    public int Id { get; set; }

    // Required string with max length
    [Required]
    [StringLength(100)]
    public string Name { get; set; } = string.Empty;

    // Required unique identifier
    [Required]
    [StringLength(20)]
    public string LicenseNumber { get; set; } = string.Empty;

    // Enum property for type-safe categories
    public LicenseLevel LicenseLevel { get; set; }

    // Validated numeric property
    [Range(0, 50)]
    public int YearsOfExperience { get; set; }

    // Decimal with precision
    [Range(0, 200)]
    public decimal HourlyRate { get; set; }

    // Boolean property
    public bool IsAvailable { get; set; } = true;
}
</pre>
            </div>
        </div>

        <!-- Code Example: Enums with Display Attributes -->
        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <div class="mb-3">
                <p class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Code Example 2</p>
                <h3 class="text-lg font-semibold text-gray-800 mt-1">Enums with Display Attributes</h3>
            </div>
            <p class="text-xs text-gray-600 mb-3">
                Use enums to represent categorical data with type safety, and [Display] attributes for friendly UI
                labels.
            </p>
            <ul class="list-disc pl-5 text-[11px] text-gray-600 space-y-1 mb-4">
                <li>Enums provide compile-time type safety for categorical values</li>
                <li><code class="px-1 rounded bg-gray-100">[Display(Name="...")]</code> sets friendly labels for UI</li>
                <li>EF Core stores enum values as integers in the database</li>
            </ul>
            <div class="bg-gray-100 rounded-lg p-4 overflow-x-auto">
                <pre data-code-title="C# (Models/LicenseLevel.cs)">
using System.ComponentModel.DataAnnotations;

namespace BlazorMock.Models;

public enum LicenseLevel
{
    [Display(Name = "Class A (Heavy Trucks)")]
    ClassA = 1,

    [Display(Name = "Class B (Medium Trucks)")]
    ClassB = 2,

    [Display(Name = "Class C (Light Vehicles)")]
    ClassC = 3
}
</pre>
            </div>
        </div>

        <!-- Code Example: Relationships -->
        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <div class="mb-3">
                <p class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Code Example 3</p>
                <h3 class="text-lg font-semibold text-gray-800 mt-1">Model Relationships</h3>
            </div>
            <p class="text-xs text-gray-600 mb-3">
                Define relationships between entities using navigation properties and foreign keys.
            </p>
            <ul class="list-disc pl-5 text-[11px] text-gray-600 space-y-1 mb-4">
                <li>One-to-Many: collection property on principal, single property + FK on dependent</li>
                <li>Foreign key follows convention: <code class="px-1 rounded bg-gray-100">{NavigationProperty}Id</code>
                </li>
                <li><code class="px-1 rounded bg-gray-100">null!</code> suppresses nullability warnings for
                    EF-initialized properties</li>
            </ul>
            <div class="bg-gray-100 rounded-lg p-4 overflow-x-auto">
                <pre data-code-title="C# (One-to-Many Relationship)">
// Principal Entity (One side)
public class Driver
{
    public int Id { get; set; }
    public string Name { get; set; } = string.Empty;
    
    // Collection navigation property
    public ICollection&lt;Route&gt; Routes { get; set; } = new List&lt;Route&gt;();
}

// Dependent Entity (Many side)
public class Route
{
    public int Id { get; set; }
    public string Destination { get; set; } = string.Empty;
    
    // Foreign key
    public int DriverId { get; set; }
    
    // Navigation property (EF Core will populate this)
    public Driver Driver { get; set; } = null!;
}
</pre>
            </div>
        </div>

        <!-- Live Demo -->
        <div class="bg-black/3 rounded-2xl p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üé¨ Live Demo: Model Validation</h2>
            <p class="text-sm text-gray-600 mb-4">
                Try creating a driver to see data annotations validation in action. Leave fields empty or enter invalid
                values to trigger validation errors.
            </p>

            <div class="bg-white rounded-2xl border border-gray-200 p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Create New Driver</h3>

                <EditForm Model="sampleDriver" OnValidSubmit="HandleSubmit" FormName="DriverForm">
                    <DataAnnotationsValidator />

                    <div class="space-y-4">
                        <!-- Name -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                            <InputText @bind-Value="sampleDriver.Name"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                            <ValidationMessage For="() => sampleDriver.Name" class="text-xs text-red-600 mt-1" />
                        </div>

                        <!-- License Number -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">License Number *</label>
                            <InputText @bind-Value="sampleDriver.LicenseNumber"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                            <ValidationMessage For="() => sampleDriver.LicenseNumber"
                                class="text-xs text-red-600 mt-1" />
                        </div>

                        <!-- License Level -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">License Level</label>
                            <InputSelect @bind-Value="sampleDriver.LicenseLevel"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                @foreach (var level in Enum.GetValues<LicenseLevel>())
                                {
                                    <option value="@level">@GetLicenseDisplay(level)</option>
                                }
                            </InputSelect>
                        </div>

                        <!-- Years of Experience -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Years of Experience
                                (0-50)</label>
                            <InputNumber @bind-Value="sampleDriver.YearsOfExperience"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                            <ValidationMessage For="() => sampleDriver.YearsOfExperience"
                                class="text-xs text-red-600 mt-1" />
                        </div>

                        <!-- Hourly Rate -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hourly Rate ($0-$200)</label>
                            <InputNumber @bind-Value="sampleDriver.HourlyRate"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                            <ValidationMessage For="() => sampleDriver.HourlyRate" class="text-xs text-red-600 mt-1" />
                        </div>

                        <!-- Is Available -->
                        <div class="flex items-center gap-2">
                            <InputCheckbox @bind-Value="sampleDriver.IsAvailable"
                                class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                            <label class="text-sm font-medium text-gray-700">Available for Assignment</label>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit"
                            class="w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                            Validate & Display
                        </button>

                        <!-- Success Message -->
                        @if (showSuccess)
                        {
                            <div class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                                <h4 class="text-sm font-semibold text-green-900 mb-2">‚úì Validation Passed!</h4>
                                <dl class="text-xs text-green-800 space-y-1">
                                    <div class="flex gap-2">
                                        <dt class="font-semibold">Name:</dt>
                                        <dd>@sampleDriver.Name</dd>
                                    </div>
                                    <div class="flex gap-2">
                                        <dt class="font-semibold">License:</dt>
                                        <dd>@sampleDriver.LicenseNumber (@GetLicenseDisplay(sampleDriver.LicenseLevel))</dd>
                                    </div>
                                    <div class="flex gap-2">
                                        <dt class="font-semibold">Experience:</dt>
                                        <dd>@sampleDriver.YearsOfExperience years</dd>
                                    </div>
                                    <div class="flex gap-2">
                                        <dt class="font-semibold">Rate:</dt>
                                        <dd>$@sampleDriver.HourlyRate/hr</dd>
                                    </div>
                                    <div class="flex gap-2">
                                        <dt class="font-semibold">Status:</dt>
                                        <dd>@(sampleDriver.IsAvailable ? "Available" : "Unavailable")</dd>
                                    </div>
                                </dl>
                            </div>
                        }
                    </div>
                </EditForm>
            </div>

            <p class="text-xs text-gray-600 mt-4 text-center">
                üí° Try submitting with empty fields or values outside the valid range to see data annotations at work
            </p>
        </div>

        <!-- Important Notes & Tips -->
        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üí° Important Notes & Tips</h2>

            <!-- Pro Tips -->
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                <h3 class="text-lg font-semibold text-blue-900 mb-3">üíé Pro Tips</h3>
                <ul class="list-disc pl-5 text-blue-800 space-y-2">
                    <li><strong>POCO principle:</strong> Keep models simple - just properties and basic logic, no
                        framework dependencies outside EF annotations</li>
                    <li><strong>Initialization:</strong> Initialize collection properties (ICollection&lt;T&gt;) in the
                        property declaration to avoid null reference errors</li>
                    <li><strong>null! operator:</strong> Use on navigation properties that EF Core will populate - tells
                        compiler "trust me, this won't be null at runtime"</li>
                    <li><strong>Business logic placement:</strong> Models can contain domain logic methods, but keep
                        database operations in repositories or services</li>
                    <li><strong>[Column(TypeName)]:</strong> Use to specify exact database column types like
                        "decimal(18,2)" or "varchar(50)" for precise control</li>
                </ul>
            </div>

            <!-- Troubleshooting -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                <h3 class="text-lg font-semibold text-yellow-900 mb-3">‚ö†Ô∏è Troubleshooting</h3>
                <ul class="list-disc pl-5 text-yellow-800 space-y-2">
                    <li><strong>Id not recognized as primary key:</strong> Ensure property is named "Id" or
                        "{ClassName}Id" - EF Core convention-based detection</li>
                    <li><strong>Navigation property null:</strong> Use .Include() when querying to load related
                        entities, or use null! to suppress warnings for EF-managed properties</li>
                    <li><strong>String validation not working:</strong> Verify [Required] and [StringLength] are from
                        System.ComponentModel.DataAnnotations namespace</li>
                    <li><strong>Enum stored as string:</strong> By default enums are stored as integers - use
                        [Column(TypeName = "varchar")] or Fluent API to store as strings</li>
                    <li><strong>Circular reference errors:</strong> When serializing models with navigation properties,
                        use DTOs or configure JSON serialization to handle reference loops</li>
                </ul>
            </div>
        </div>

        <!-- How to do it -->
        <div class="bg-gradient-to-r from-gray-100 to-blue-100 rounded-xl p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üõ†Ô∏è How to do it</h2>

            <div class="space-y-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">1Ô∏è‚É£ Create Model Files</h3>
                    <p class="text-gray-700 mb-2">
                        Create C# class files in the Models/ folder (e.g., Driver.cs, Truck.cs, Route.cs) for your
                        domain entities.
                    </p>
                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                        <code class="text-xs text-gray-700">
                            Models/Driver.cs, Models/Truck.cs, Models/Route.cs
                        </code>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">2Ô∏è‚É£ Add Data Annotations</h3>
                    <p class="text-gray-700 mb-2">
                        Apply validation and configuration attributes: [Required], [StringLength(n)], [Range(min, max)],
                        [EmailAddress], etc.
                    </p>
                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                        <code class="text-xs text-gray-700">
                            using System.ComponentModel.DataAnnotations;
                        </code>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">3Ô∏è‚É£ Define Enums</h3>
                    <p class="text-gray-700 mb-2">
                        Create enum types for categorical data and add [Display(Name = "...")] for friendly labels in
                        forms.
                    </p>
                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                        <code class="text-xs text-gray-700">
                            public enum LicenseLevel with [Display] attributes for each value
                        </code>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">4Ô∏è‚É£ Establish Relationships</h3>
                    <p class="text-gray-700 mb-2">
                        Add navigation properties and foreign keys to define relationships (one-to-many, many-to-many,
                        one-to-one).
                    </p>
                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                        <code class="text-xs text-gray-700">
                            Collection properties for "many" side, FK + navigation property for "one" side
                        </code>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">5Ô∏è‚É£ Initialize Collections</h3>
                    <p class="text-gray-700 mb-2">
                        Always initialize collection navigation properties to empty lists in property declarations to
                        prevent null reference exceptions.
                    </p>
                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                        <code class="text-xs text-gray-700">
                            public ICollection&lt;Route&gt; Routes { get; set; } = new List&lt;Route&gt;();
                        </code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Demo -->
        <div class="bg-white rounded-xl p-6 border border-gray-200 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üéÆ Interactive Demo: Driver Model</h2>
            <p class="text-gray-700 mb-6">
                Create a sample driver instance and see the model properties in action.
            </p>

            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Name:</label>
                        <input type="text" @bind="sampleDriver.Name"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 bg-white" />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">License Number:</label>
                        <input type="text" @bind="sampleDriver.LicenseNumber"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 bg-white" />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">License Level:</label>
                        <select @bind="sampleDriver.LicenseLevel"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 bg-white">
                            @foreach (var level in Enum.GetValues<LicenseLevel>())
                            {
                                <option value="@level">@GetLicenseDisplay(level)</option>
                            }
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Years of Experience:</label>
                        <input type="number" @bind="sampleDriver.YearsOfExperience" min="0" max="50"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 bg-white" />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Hourly Rate:</label>
                        <input type="number" @bind="sampleDriver.HourlyRate" min="0" max="200" step="0.01"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 bg-white" />
                    </div>

                    <div class="flex items-center">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" @bind="sampleDriver.IsAvailable"
                                class="w-4 h-4 text-orange-600 rounded" />
                            <span class="text-sm font-medium text-gray-700">Available for Assignment</span>
                        </label>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-4 border border-gray-300">
                    <h3 class="font-semibold text-gray-800 mb-3">üìã Model Instance Values:</h3>
                    <div class="space-y-1 text-sm text-gray-700 font-mono">
                        <p><strong>Name:</strong> @sampleDriver.Name</p>
                        <p><strong>License Number:</strong> @sampleDriver.LicenseNumber</p>
                        <p><strong>License Level:</strong> @GetLicenseDisplay(sampleDriver.LicenseLevel)</p>
                        <p><strong>Experience:</strong> @sampleDriver.YearsOfExperience years</p>
                        <p><strong>Hourly Rate:</strong> $@sampleDriver.HourlyRate.ToString("F2")</p>
                        <p><strong>Status:</strong> @(sampleDriver.IsAvailable ? "‚úÖ Available" : "‚ùå Unavailable")</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mark Complete -->
        <div class="bg-white rounded-xl p-6 border border-gray-200">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Ready to move on?</h3>
                    <p class="text-gray-600">
                        @if (isComplete)
                        {
                            <span class="text-green-600 font-medium">‚úÖ Step completed!</span>
                        }
                        else
                        {
                            <span>Mark this step as complete when you're ready.</span>
                        }
                    </p>
                </div>
                <div class="flex gap-3">
                    @if (!isComplete)
                    {
                        <button @onclick="MarkComplete"
                            class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">
                            ‚úì Mark Complete
                        </button>
                    }
                    else
                    {
                        <button @onclick="ResetStep"
                            class="px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            Reset Step
                        </button>
                    }
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="mt-8">
            <div class="bg-black/90 rounded-2xl p-6 sm:p-8 text-white text-center">
                <p class="text-lg sm:text-xl font-semibold mb-4">Continue Learning</p>
                <p class="text-sm text-gray-300 mb-6 max-w-2xl mx-auto">
                    Database connected! Now let's implement full CRUD operations.
                </p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
                    <a href="/trucking-guide"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl transition-colors">
                        <span class="text-lg">‚Üê</span>
                        <span class="text-sm sm:text-base font-semibold">Back to Guide</span>
                    </a>
                    <a href="/trucking-examples/step6"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl transition-colors">
                        <span class="text-lg">‚Üê</span>
                        <span class="text-sm sm:text-base font-semibold">Previous: Step 6</span>
                    </a>
                    <a href="/trucking-examples/step8"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl transition-colors">
                        <span class="text-sm sm:text-base font-semibold">Next: Step 8</span>
                        <span class="text-lg">‚Üí</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>