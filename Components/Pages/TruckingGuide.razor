@page "/trucking-guide"
@inject ILearningProgressService ProgressService
@inject ILearningGuideService GuideService
@rendermode InteractiveServer

<PageTitle>Trucking Learning Guide</PageTitle>

<style>
    @@keyframes fade-in {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in {
        animation: fade-in 0.4s ease-out;
    }
</style>

<div class="min-h-screen py-8">
    <div class="w-full mx-auto px-4 max-w-5xl">
        <!-- Header Section -->
        <div class="text-center mb-12 animate-fade-in">
            <div class="flex flex-col items-center justify-center gap-3 mb-4">
                <span class="text-6xl sm:text-7xl">ðŸšš</span>
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900">
                    Trucking Learning Guide
                </h1>
            </div>
            <p class="text-base sm:text-lg md:text-xl text-gray-600 mb-6 leading-relaxed">
                Step-by-step guide to building a professional Trucking Schedule Management System
            </p>
            @if (completedCount >= 4)
            {
                <div
                    class="inline-flex items-center gap-2 bg-green-50 border-2 border-green-200 rounded-full px-4 py-2 hover:bg-green-100 transition-colors">
                    <span class="text-sm sm:text-base text-green-600 font-semibold">Phase 1 Complete!</span>
                    <span class="text-sm sm:text-base text-green-600">âœ“ Steps 1-4</span>
                </div>
            }
        </div>

        <!-- Phases Hub -->
        <div class="bg-gradient-to-r from-gray-100 to-blue-100 rounded-2xl p-5 sm:p-6 mt-12 animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-3">ðŸ”° Learning Phases</h2>
            <p class="text-sm sm:text-base text-gray-700">Pick a phase to focus on. Each card links to interactive steps
                with examples and exercises.</p>
        </div>

        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 my-10 max-w-6xl mx-auto animate-fade-in">
            @foreach (var ph in GuideService.GetPhases())
            {
                var count = steps.Count(s => s.IsComplete && ph.StepNumbers.Contains(s.StepNumber));
                var isComplete = count == ph.StepNumbers.Length;
                <a href="@($"/guide/phase/{ph.Id}")"
                    class="@($"rounded-2xl bg-white border-2 border-gray-200 hover:shadow-lg transition-all duration-200 text-left {PhaseHoverBorder(ph.Id)} group")">
                    <div class="p-6 sm:p-8">
                        <div class="flex items-start justify-between gap-4 mb-3">
                            <div class="min-w-0 flex-1">
                                <div
                                    class="@($"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium {PhasePillColors(ph.Id)} mb-2")">
                                    @ph.Subtitle
                                </div>
                                <h3
                                    class="text-xl sm:text-2xl font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">
                                    @ph.Title</h3>
                                <p class="text-sm sm:text-base text-gray-700 leading-relaxed">@ph.Description</p>
                            </div>
                            <div
                                class="text-gray-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all flex-shrink-0 text-xl">
                                â†’</div>
                        </div>
                        <div class="flex items-center gap-2 mt-4 pt-4 border-t border-gray-100">
                            <div class="text-sm font-medium text-gray-700">Progress: @count/@ph.StepNumbers.Length</div>
                            @if (isComplete)
                            {
                                <span class="ml-auto text-green-600 text-sm font-semibold">âœ“ Complete</span>
                            }
                        </div>
                    </div>
                </a>
            }
        </div>

        <!-- Quick Links Section -->
        <div class="bg-black/90 rounded-2xl p-5 sm:p-6 text-white animate-fade-in">
            <h2 class="text-lg sm:text-xl font-semibold mb-4 text-center">ðŸ“š Learning Resources</h2>

            <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                <a href="/demo/trucking-schedule"
                    class="bg-white/10 hover:bg-white/20 rounded-xl p-4 transition-all duration-200 hover:scale-105 hover:shadow-lg group">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl flex-shrink-0 group-hover:scale-110 transition-transform">ðŸ“–</span>
                        <div class="min-w-0">
                            <div class="text-sm sm:text-base font-semibold mb-1">Trucking Schedule Demo</div>
                            <div class="text-xs sm:text-sm text-gray-300">Finished product: routes, drivers, trucks
                            </div>
                        </div>
                    </div>
                </a>
                <a href="/tips"
                    class="bg-white/10 hover:bg-white/20 rounded-xl p-4 transition-all duration-200 hover:scale-105 hover:shadow-lg group">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl flex-shrink-0 group-hover:scale-110 transition-transform">ðŸ’¡</span>
                        <div class="min-w-0">
                            <div class="text-sm sm:text-base font-semibold mb-1">Tips System</div>
                            <div class="text-xs sm:text-sm text-gray-300">Browse 57+ Blazor & C# topics</div>
                        </div>
                    </div>
                </a>
                <a href="/progress"
                    class="bg-white/10 hover:bg-white/20 rounded-xl p-4 transition-all duration-200 hover:scale-105 hover:shadow-lg group">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl flex-shrink-0 group-hover:scale-110 transition-transform">ðŸ“Š</span>
                        <div class="min-w-0">
                            <div class="text-sm sm:text-base font-semibold mb-1">Track Progress</div>
                            <div class="text-xs sm:text-sm text-gray-300">View all 14 steps & completion</div>
                        </div>
                    </div>
                </a>
            </div>
            <div class="text-center text-xs sm:text-sm text-gray-300 pt-4 border-t border-white/10">
                <strong>Overall Progress:</strong> @completedCount/14 steps complete
                @if (completedCount >= 4)
                {
                    <span
                        class="inline-block ml-2 px-2 py-0.5 bg-green-500/20 border border-green-400/30 rounded text-green-300">Phase
                        1 âœ…</span>
                }
                @if (completedCount >= 9)
                {
                    <span
                        class="inline-block ml-2 px-2 py-0.5 bg-blue-500/20 border border-blue-400/30 rounded text-blue-300">Phase
                        2 âœ…</span>
                }
                @if (completedCount == 14)
                {
                    <span
                        class="inline-block ml-2 px-2 py-0.5 bg-purple-500/20 border border-purple-400/30 rounded text-purple-300">Phase
                        3 âœ…</span>
                }
            </div>
        </div>
    </div>
</div>

@code {
    private List<StepProgress> steps = new();
    private int completedCount = 0;

    protected override async Task OnInitializedAsync()
    {
        steps = (await ProgressService.GetAllStepsAsync()).ToList();
        completedCount = await ProgressService.GetCompletedCountAsync();
    }

    // Phase card styling helpers to match Tips page feel and keep phase color accents
    private static string PhaseHoverBorder(string id) => id switch
    {
        "phase-1" => "hover:border-purple-400",
        "phase-2" => "hover:border-blue-400",
        "phase-3" => "hover:border-emerald-400",
        _ => "hover:border-gray-300"
    };

    private static string PhasePillColors(string id) => id switch
    {
        "phase-1" => "bg-purple-50 text-purple-700 border border-purple-200",
        "phase-2" => "bg-blue-50 text-blue-700 border border-blue-200",
        "phase-3" => "bg-emerald-50 text-emerald-700 border border-emerald-200",
        _ => "bg-gray-50 text-gray-700 border border-gray-200"
    };

    private static string PhaseGradient(string id) => id switch
    {
        "phase-1" => "bg-gradient-to-r from-purple-200 to-purple-400",
        "phase-2" => "bg-gradient-to-r from-blue-200 to-blue-400",
        "phase-3" => "bg-gradient-to-r from-emerald-200 to-emerald-400",
        _ => "bg-gradient-to-r from-gray-200 to-gray-300"
    };
}