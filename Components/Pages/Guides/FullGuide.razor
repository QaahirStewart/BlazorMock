@page "/guide/full"
@namespace BlazorMock.Pages
@inject ILearningProgressService ProgressService
@inject ILearningGuideService GuideService
@rendermode InteractiveServer

<PageTitle>Blazor Learning Guide</PageTitle>

<div class="min-h-screen py-8">
    <div class="w-full mx-auto px-4 max-w-5xl">
        <!-- Header Section -->
        <div class="text-center mb-12">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-4 break-words">
                ðŸ“š Blazor Learning Guide
            </h1>
            <p class="text-base sm:text-lg md:text-xl text-gray-600 mb-4 leading-relaxed break-words">
                Step-by-step guide to building a Trucking Schedule App
            </p>
            @if (completedCount >= 4)
            {
                <div class="inline-flex items-center gap-2 bg-green-50 border border-green-200 rounded-full px-4 py-2">
                    <span class="text-sm sm:text-base text-green-600 font-semibold">Phase 1 Complete!</span>
                    <span class="text-sm sm:text-base text-green-600">âœ“ Steps 1-4</span>
                </div>
            }
        </div>



        @* Removed: Today's Information card *@

        @* Needs to Move to full Learning Guide *@

        <!-- What You'll Learn Overview -->
        @* <div class="bg-black/3 rounded-2xl p-5 sm:p-6 mb-8">
            <h3 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-6 flex items-center break-words">
                <span class="mr-2">ðŸŽ¯</span>
                What You'll Learn
            </h3>
            <div class="grid sm:grid-cols-1 gap-3 sm:gap-4">
                <div class="space-y-3">
                    <div class="flex items-center gap-3 p-3 rounded-2xl border border-gray-200 bg-white">
                        <span
                            class="inline-flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-gray-100 text-gray-600 text-xs">â€¢</span>
                        <span class="text-sm sm:text-base text-gray-800 break-words">Blazor Server components and
                            routing</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 rounded-2xl border border-gray-200 bg-white">
                        <span
                            class="inline-flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-gray-100 text-gray-600 text-xs">â€¢</span>
                        <span class="text-sm sm:text-base text-gray-800 break-words">Forms and validation</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 rounded-2xl border border-gray-200 bg-white">
                        <span
                            class="inline-flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-gray-100 text-gray-600 text-xs">â€¢</span>
                        <span class="text-sm sm:text-base text-gray-800 break-words">Entity Framework Core</span>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex items-center gap-3 p-3 rounded-2xl border border-gray-200 bg-white">
                        <span
                            class="inline-flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-gray-100 text-gray-600 text-xs">â€¢</span>
                        <span class="text-sm sm:text-base text-gray-800 break-words">Driver and truck management</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 rounded-2xl border border-gray-200 bg-white">
                        <span
                            class="inline-flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-gray-100 text-gray-600 text-xs">â€¢</span>
                        <span class="text-sm sm:text-base text-gray-800 break-words">Route scheduling and
                            assignments</span>
                    </div>
                </div>
            </div>
        </div> *@

        @* Moved: Step 0 and demos to /guide/demos *@

        <!-- Phases Hub -->
        <div class="bg-gradient-to-r from-gray-100 to-blue-100 rounded-2xl p-5  mt-12">
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2 break-words">ðŸ”° Learning Phases</h2>
            <p class="text-sm sm:text-base text-gray-700 break-words">Pick a phase to focus. Each card links to steps
                with examples.</p>
        </div>

        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 my-10 max-w-6xl mx-auto">
            @foreach (var ph in GuideService.GetPhases())
            {
                var count = steps.Count(s => s.IsComplete && ph.StepNumbers.Contains(s.StepNumber));
                <a href="@($"/guide/phase/{ph.Id}")"
                    class="@($"rounded-2xl p-0 bg-white border-2 border-gray-200 hover:shadow-lg transition-all text-left {PhaseHoverBorder(ph.Id)}")">
                    <div></div>
                    <div class="p-8">
                        <div class="flex items-start justify-between gap-4 mb-3">
                            <div class="min-w-0">
                                <div
                                    class="@($"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium {PhasePillColors(ph.Id)} mb-2")">
                                    @ph.Subtitle</div>
                                <h3 class="text-2xl font-bold text-gray-900 mb-1 break-words">@ph.Title</h3>
                                <p class="text-sm sm:text-base text-gray-700 leading-relaxed break-words">@ph.Description
                                </p>
                            </div>
                            <div class="text-gray-400 self-start">â†’</div>
                        </div>
                        <div class="text-sm text-gray-600">Progress: @count/@ph.StepNumbers.Length</div>
                    </div>
                </a>
            }
        </div>

        <!-- Demos CTA -->
        @* <div class="rounded-2xl p-5 border border-gray-200 bg-white mb-8">
            <div class="flex items-center justify-between gap-3">
                <div>
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-900">Hands-on Demos</h3>
                    <p class="text-sm text-gray-600">All step demos (0â€“13) have moved to the demos hub.</p>
                </div>
                <a href="/guide/demos"
                    class="px-3 py-2 rounded-full bg-blue-600 hover:bg-blue-700 text-white text-sm">Open demos â†’</a>
            </div>
        </div> *@

        @* Moved: Phase 1 preview cards to /guide/demos *@

        @* Moved: Quick demo to /guide/demos *@

        @* Moved: Reusable components demo to /guide/demos *@

        @* Moved: Event Binding demo to /guide/demos *@

        @* Moved: Forms & Validation demo to /guide/demos *@
        <!-- Quick Links Section -->
        <div class="bg-black/3 rounded-2xl ">

            <div class="bg-black/90 rounded-2xl p-5 sm:p-6 text-white">
                <p class="text-lg sm:text-xl font-semibold mb-4 text-center break-words ">ï¿½ Learning Resources
                </p>

                <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                    <a href="/guide/full" class="bg-white/10 hover:bg-white/20 rounded-xl p-4 transition-colors">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl flex-shrink-0">ðŸ“–</span>
                            <div class="min-w-0">
                                <div class="text-sm sm:text-base font-semibold break-words">Full Learning Guide</div>
                                <div class="text-xs sm:text-sm text-gray-300 break-words">Detailed steps with code
                                    examples</div>
                            </div>
                        </div>
                    </a>
                    <a href="/tips" class="bg-white/10 hover:bg-white/20 rounded-xl p-4 transition-colors">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl flex-shrink-0">ðŸ’¡</span>
                            <div class="min-w-0">
                                <div class="text-sm sm:text-base font-semibold break-words">Tips System</div>
                                <div class="text-xs sm:text-sm text-gray-300 break-words">Browse 20+ Blazor & C# topics
                                </div>
                            </div>
                        </div>
                    </a>
                    <a href="/progress" class="bg-white/10 hover:bg-white/20 rounded-xl p-4 transition-colors">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl flex-shrink-0">ðŸ“Š</span>
                            <div class="min-w-0">
                                <div class="text-sm sm:text-base font-semibold break-words">Track Progress</div>
                                <div class="text-xs sm:text-sm text-gray-300 break-words">View all 14 steps & completion
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="text-center text-xs sm:text-sm text-gray-300 break-words">
                    <strong>Progress:</strong> @completedCount/14 steps complete @if (completedCount >= 4) {
                    <span>-
                        Phase 1 âœ…</span>
                                        }
                </div>
            </div>
        </div>
    </div>
    </div>

@code {
    private List<StepProgress> steps = new();
    private int completedCount = 0;

    protected override async Task OnInitializedAsync()
    {
        steps = (await ProgressService.GetAllStepsAsync()).ToList();
        completedCount = await ProgressService.GetCompletedCountAsync();
    }

    // Phase card styling helpers to match Tips page feel and keep phase color accents
    private static string PhaseHoverBorder(string id) => id switch
    {
        "phase-1" => "hover:border-purple-400",
        "phase-2" => "hover:border-blue-400",
        "phase-3" => "hover:border-emerald-400",
        _ => "hover:border-gray-300"
    };

    private static string PhasePillColors(string id) => id switch
    {
        "phase-1" => "bg-purple-50 text-purple-700 border border-purple-200",
        "phase-2" => "bg-blue-50 text-blue-700 border border-blue-200",
        "phase-3" => "bg-emerald-50 text-emerald-700 border border-emerald-200",
        _ => "bg-gray-50 text-gray-700 border border-gray-200"
    };

    private static string PhaseGradient(string id) => id switch
    {
        "phase-1" => "bg-gradient-to-r from-purple-200 to-purple-400",
        "phase-2" => "bg-gradient-to-r from-blue-200 to-blue-400",
        "phase-3" => "bg-gradient-to-r from-emerald-200 to-emerald-400",
        _ => "bg-gradient-to-r from-gray-200 to-gray-300"
    };
}